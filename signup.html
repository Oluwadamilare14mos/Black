<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Account â€” Black</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: "#ff6600",
            accent: "#ff3300",
            dark: "#111827"
          },
          fontFamily: { poppins: ["Poppins", "sans-serif"] },
        },
      },
    };
  </script>

  <style>
    body { font-family: Poppins, sans-serif; background:#fff; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100">

  <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-8">
    <h2 class="text-3xl font-extrabold text-center text-brand mb-6">Create Account</h2>

    <!-- FORM -->
    <form id="signupForm" class="space-y-4">

      <div>
        <label class="block text-sm font-medium">First Name</label>
        <input id="firstName" type="text" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
      </div>

      <div>
        <label class="block text-sm font-medium">Last Name</label>
        <input id="lastName" type="text" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
      </div>

      <div>
        <label class="block text-sm font-medium">Age</label>
        <input id="age" type="number" min="1" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
      </div>

      <div>
        <label class="block text-sm font-medium">Gender</label>
        <select id="gender" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
          <option value="">Select gender</option>
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium">Profile Picture (optional)</label>
        <input id="photo" type="file" accept="image/*" class="w-full">
      </div>

      <div>
        <label class="block text-sm font-medium">Email</label>
        <input id="email" type="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
      </div>

      <div>
        <label class="block text-sm font-medium">Password</label>
        <input id="password" type="password" required class="w-full px-4 py-2 border rounded-lg focus:ring-brand focus:outline-none">
      </div>

      <button type="submit" class="w-full py-3 bg-brand text-white rounded-full font-semibold text-lg">
        Create Account
      </button>

      <p class="text-center mt-3 text-sm">
        Already have an account?
        <a href="login.html" class="text-brand font-semibold">Sign In</a>
      </p>

    </form>
  </div>

  <!-- Firebase + Firestore + ImgBB -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getAuth, 
      createUserWithEmailAndPassword,
      updateProfile,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    import {
      getFirestore,
      doc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyDsrL5UHWeFtQAX5XCI1hX7As91PWz59Cs",
  authDomain: "black-1108.firebaseapp.com",
  projectId: "black-1108",
  storageBucket: "black-1108.appspot.com",
  messagingSenderId: "639439190327",
  appId: "1:639439190327:web:b08b640aba7e8f7d76c2b2"
  };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* ---------------------------------------------------------
      ðŸ”’ AUTH PROTECTION FOR SIGNUP.HTML
      If user is already logged in â†’ redirect to index.html
    ---------------------------------------------------------- */
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = "index.html";
      }
    });

    const form = document.getElementById("signupForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const age = document.getElementById("age").value;
      const gender = document.getElementById("gender").value;
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const photoFile = document.getElementById("photo").files[0];

      let imageUrl = "https://img.icons8.com/ios-filled/100/000000/user.png"; // default avatar

      try {
        if (photoFile) {
          const formData = new FormData();
          formData.append("image", photoFile);

          const upload = await fetch(
            "https://api.imgbb.com/1/upload?key=43cbd9a554a2ba4dad8ca1eca995df94",
            { method: "POST", body: formData }
          );

          const result = await upload.json();

          if (result.success) {
            imageUrl = result.data.url;
          }
        }

        const userCredential = await createUserWithEmailAndPassword(auth, email, password);

        await updateProfile(userCredential.user, {
          displayName: firstName,
          photoURL: imageUrl
        });

        await setDoc(doc(db, "users", userCredential.user.uid), {
          firstName,
          lastName,
          age,
          gender,
          email,
          photoURL: imageUrl
        });

        window.location.href = "index.html";

      } catch (err) {
        alert(err.message);
      }
    });
  </script>

</body>
</html>
